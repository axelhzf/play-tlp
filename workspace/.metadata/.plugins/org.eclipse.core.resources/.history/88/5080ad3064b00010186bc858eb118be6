package controllers;

import java.util.Date;
import java.util.List;

import flexjson.JSONSerializer;

import models.Tweet;
import play.data.validation.Valid;
import play.mvc.Controller;
import play.mvc.With;

@With(Secure.class)
public class Timeline extends Controller {

	public static void index(){
		List<Tweet> tweets = Tweet.find("order by date desc").fetch();
		render(tweets);
	}
	
	
	public static void addTweet(@Valid Tweet tweet) {
		if (validation.hasErrors()) {
			params.flash();
			validation.keep();
		} else {
			tweet.author = Security.userConnected();
			tweet.date = new Date();
			tweet.save();
		}
		index();
	}
	
	public static void tweets(){
	    List<Tweet> tweets = Tweet.find("order by date desc").fetch();
	    renderJSON(new JSONSerializer().include("msg", "date", "author.username").exclude("*").serialize(tweets));
	}
	
}
