#{extends 'main.html' /}
#{set title:'timeline' /}

	<div class="happening">
	#{form @Timeline.addTweet(), id:"tweet-form"}
		<label>What's happening</label>
		<textarea name="tweet.msg"> </textarea>
		<div class="button_container">
			<input type="submit" value="Tweet">
		</div>
	#{/form}
	</div>

#{ifErrors}
<ul class="errors">
#{errors}
    <li>${error}</li>
#{/errors}
</ul>
#{/ifErrors}

<div id="tweets"></div>

<script>
    function cargarTweets(){
        var listAction = #{jsAction @Timeline.tweets() /}
        $.get(listAction({}), function(data){
            var html = '';
            $.each(data, function(i, tweet) {
                var date = new Date(tweet.date);
                html += '<div class="tweet"><div class="tweet-author"><a href="/' + tweet.author.username + '"> ' + tweet.author.username +'</a></div><div class="tweet-msg"> ' + tweet.msg + '</div><div class="tweet-date"> ' + date.toLocaleDateString() + '</div></div>'
            });
            $('#tweets').html(html);
        });
    }

    $(function(){
        cargarTweets();
        $('#tweet-submit').click(function(){
            $.post('@{Timeline.addTweet}', $('#tweet-form').serialize(), function(){
                $('#tweet-msg').val('');
                cargarTweets();
            });
            return false;
        });
    });
</script>